{% extends 'base.html' %}

{% block title %}الآلة الحاسبة المتقدمة - المنصة التعليمية{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card bg-dark mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4><i class="fas fa-calculator me-2"></i>الآلة الحاسبة المتقدمة</h4>
                <a href="{{ url_for('student.advanced_calculator_en') }}" class="btn btn-outline-primary">
                    <i class="fas fa-language me-1"></i>English
                </a>
            </div>
            <div class="card-body">
                <p class="lead">
                    آلة حاسبة متقدمة تدعم العمليات الرياضية المعقدة والرسم البياني للدوال والمعادلات.
                </p>
                <div class="d-flex justify-content-end">
                    <a href="{{ url_for('student.algebra_formulas') }}" class="btn btn-primary">
                        <i class="fas fa-book me-2"></i>قوانين الجبر
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6 mb-4">
        <div class="card bg-dark">
            <div class="card-header">
                <h5><i class="fas fa-calculator me-2"></i>الآلة الحاسبة العلمية</h5>
            </div>
            <div class="card-body">
                <div class="calculator-container">
                    <div class="mb-3">
                        <input type="text" id="display" class="form-control mb-2 text-end" readonly>
                        <div id="result" class="alert alert-info mb-3 text-end" style="min-height: 60px;"></div>
                    </div>
                    
                    <div class="row mb-2">
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('sin(')">sin</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('cos(')">cos</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('tan(')">tan</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('π')">π</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-danger w-100" onclick="clearDisplay()">C</button>
                        </div>
                    </div>
                    
                    <div class="row mb-2">
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('asin(')">sin⁻¹</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('acos(')">cos⁻¹</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('atan(')">tan⁻¹</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('abs(')">|x|</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('!')">&excl;</button>
                        </div>
                    </div>
                    
                    <div class="row mb-2">
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('√(')">√</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('^2')">x²</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('^')">x^y</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('log(')">log</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('ln(')">ln</button>
                        </div>
                    </div>
                    
                    <div class="row mb-2">
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('7')">7</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('8')">8</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('9')">9</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('/')">/</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('(')">(</button>
                        </div>
                    </div>
                    
                    <div class="row mb-2">
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('4')">4</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('5')">5</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('6')">6</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('*')">×</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay(')')">)</button>
                        </div>
                    </div>
                    
                    <div class="row mb-2">
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('1')">1</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('2')">2</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('3')">3</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('-')">-</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-warning w-100" onclick="backspace()">⌫</button>
                        </div>
                    </div>
                    
                    <div class="row mb-2">
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('0')">0</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-light w-100" onclick="addToDisplay('.')">.</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('e')">e</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-secondary w-100" onclick="addToDisplay('+')">+</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-success w-100" onclick="calculate()">=</button>
                        </div>
                    </div>
                    
                    <div class="calculator-history mt-4">
                        <h6>سجل العمليات</h6>
                        <div id="history" class="p-2 bg-dark border" style="height: 100px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card bg-dark">
            <div class="card-header">
                <h5><i class="fas fa-chart-line me-2"></i>الرسم البياني</h5>
            </div>
            <div class="card-body">
                <div class="form-group mb-3">
                    <label for="function-input">معادلة الدالة</label>
                    <div class="input-group">
                        <span class="input-group-text">f(x) =</span>
                        <input type="text" id="function-input" class="form-control" placeholder="مثال: 2*x^2 + 3*x - 4">
                        <button class="btn btn-primary" onclick="plotFunction()">رسم</button>
                    </div>
                    <small class="form-text text-muted">استخدم x كمتغير، مثال: sin(x), x^2, 2*x+1</small>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="x-min">قيمة X الصغرى</label>
                            <input type="number" id="x-min" class="form-control" value="-10">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="x-max">قيمة X العظمى</label>
                            <input type="number" id="x-max" class="form-control" value="10">
                        </div>
                    </div>
                </div>
                
                <div id="function-graph" style="width: 100%; height: 300px;" class="border mb-3"></div>
                
                <div class="function-tools mt-3">
                    <h6>معلومات الدالة</h6>
                    <div id="function-info" class="alert alert-info"></div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-sm btn-info w-100 mb-2" onclick="findZeros()">إيجاد الأصفار</button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-sm btn-info w-100 mb-2" onclick="findExtremum()">إيجاد القيم القصوى</button>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-sm btn-info w-100 mb-2" onclick="findDerivative()">إيجاد المشتقة</button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-sm btn-info w-100 mb-2" onclick="findIntegral()">إيجاد التكامل</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-dark">
            <div class="card-header">
                <h5><i class="fas fa-tools me-2"></i>حسابات إضافية</h5>
            </div>
            <div class="card-body">
                <!-- Accordion for different calculation tools -->
                <div class="accordion" id="calculationsAccordion">
                    <!-- Unit Converter -->
                    <div class="accordion-item bg-dark">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                محول الوحدات
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#calculationsAccordion">
                            <div class="accordion-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select id="unit-type" class="form-select mb-2">
                                            <option value="length">الطول</option>
                                            <option value="weight">الوزن</option>
                                            <option value="area">المساحة</option>
                                            <option value="volume">الحجم</option>
                                            <option value="temperature">درجة الحرارة</option>
                                        </select>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="input-group mb-2">
                                            <input type="number" id="unit-value" class="form-control" placeholder="أدخل القيمة">
                                            <select id="from-unit" class="form-select"></select>
                                            <span class="input-group-text">إلى</span>
                                            <select id="to-unit" class="form-select"></select>
                                            <button class="btn btn-primary" onclick="convertUnit()">تحويل</button>
                                        </div>
                                    </div>
                                </div>
                                <div id="unit-result" class="alert alert-info">النتائج ستظهر هنا</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculus Tools -->
                    <div class="accordion-item bg-dark">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                أدوات التفاضل والتكامل
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#calculationsAccordion">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card bg-dark h-100">
                                            <div class="card-header">حساب المشتقة</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="derivative-function" class="form-label">المعادلة (مثال: 2x^3 + 4x)</label>
                                                    <input type="text" id="derivative-function" class="form-control mb-2" placeholder="أدخل المعادلة">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="derivative-variable" class="form-label">المتغير</label>
                                                    <input type="text" id="derivative-variable" class="form-control mb-2" placeholder="x" value="x">
                                                </div>
                                                <button class="btn btn-primary" onclick="solveDerivative()">حساب المشتقة</button>
                                                <div id="derivative-result" class="alert alert-info mt-3">النتائج ستظهر هنا</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card bg-dark h-100">
                                            <div class="card-header">حساب التكامل</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="integral-function" class="form-label">المعادلة (مثال: 2x + 5)</label>
                                                    <input type="text" id="integral-function" class="form-control mb-2" placeholder="أدخل المعادلة">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="integral-variable" class="form-label">المتغير</label>
                                                    <input type="text" id="integral-variable" class="form-control mb-2" placeholder="x" value="x">
                                                </div>
                                                <div class="row mb-3">
                                                    <div class="col">
                                                        <label for="integral-lower" class="form-label">الحد الأدنى (اختياري)</label>
                                                        <input type="number" id="integral-lower" class="form-control">
                                                    </div>
                                                    <div class="col">
                                                        <label for="integral-upper" class="form-label">الحد الأعلى (اختياري)</label>
                                                        <input type="number" id="integral-upper" class="form-control">
                                                    </div>
                                                </div>
                                                <button class="btn btn-primary" onclick="solveIntegral()">حساب التكامل</button>
                                                <div id="integral-result" class="alert alert-info mt-3">النتائج ستظهر هنا</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Matrix Calculator -->
                    <div class="accordion-item bg-dark">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                حاسبة المصفوفات
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#calculationsAccordion">
                            <div class="accordion-body">
                                <div class="row mb-3">
                                    <div class="col-md-6 mb-3">
                                        <label for="matrix-a" class="form-label">المصفوفة A</label>
                                        <textarea id="matrix-a" class="form-control" rows="3" placeholder="أدخل المصفوفة، مثال:&#10;1 2 3&#10;4 5 6&#10;7 8 9"></textarea>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="matrix-b" class="form-label">المصفوفة B (اختياري)</label>
                                        <textarea id="matrix-b" class="form-control" rows="3" placeholder="أدخل المصفوفة، مثال:&#10;9 8 7&#10;6 5 4&#10;3 2 1"></textarea>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col">
                                        <select id="matrix-operation" class="form-select">
                                            <option value="det">المحدد (det A)</option>
                                            <option value="inverse">المعكوس (A^-1)</option>
                                            <option value="transpose">المنقول (A^T)</option>
                                            <option value="add">الجمع (A + B)</option>
                                            <option value="multiply">الضرب (A × B)</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <button class="btn btn-primary w-100" onclick="calculateMatrix()">حساب</button>
                                    </div>
                                </div>
                                <div id="matrix-result" class="alert alert-info">النتائج ستظهر هنا</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-dark">
            <div class="card-header">
                <h5><i class="fas fa-square-root-alt me-2"></i>حل المعادلات</h5>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" id="equationTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="linear-tab" data-bs-toggle="tab" data-bs-target="#linear-eq" type="button" role="tab">معادلة خطية</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="quadratic-tab" data-bs-toggle="tab" data-bs-target="#quadratic-eq" type="button" role="tab">معادلة تربيعية</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="system-tab" data-bs-toggle="tab" data-bs-target="#system-eq" type="button" role="tab">نظام معادلات</button>
                    </li>
                </ul>
                
                <div class="tab-content py-3" id="equationTabsContent">
                    <!-- معادلة خطية -->
                    <div class="tab-pane fade show active" id="linear-eq" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>المعادلة الخطية: ax + b = 0</label>
                                    <div class="row">
                                        <div class="col">
                                            <div class="input-group mb-2">
                                                <span class="input-group-text">a =</span>
                                                <input type="number" id="linear-a" class="form-control" value="1">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="input-group mb-2">
                                                <span class="input-group-text">b =</span>
                                                <input type="number" id="linear-b" class="form-control" value="2">
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="solveLinear()">حل المعادلة</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="linear-result" class="alert alert-info" style="min-height: 100px;">
                                    النتيجة ستظهر هنا
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- معادلة تربيعية -->
                    <div class="tab-pane fade" id="quadratic-eq" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>المعادلة التربيعية: ax² + bx + c = 0</label>
                                    <div class="row">
                                        <div class="col">
                                            <div class="input-group mb-2">
                                                <span class="input-group-text">a =</span>
                                                <input type="number" id="quadratic-a" class="form-control" value="1">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="input-group mb-2">
                                                <span class="input-group-text">b =</span>
                                                <input type="number" id="quadratic-b" class="form-control" value="-3">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="input-group mb-2">
                                                <span class="input-group-text">c =</span>
                                                <input type="number" id="quadratic-c" class="form-control" value="2">
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="solveQuadratic()">حل المعادلة</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="quadratic-result" class="alert alert-info" style="min-height: 100px;">
                                    النتيجة ستظهر هنا
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- نظام معادلات -->
                    <div class="tab-pane fade" id="system-eq" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>نظام معادلات خطية:</label>
                                    <div class="mb-2">
                                        <div class="input-group mb-2">
                                            <input type="number" id="system-a11" class="form-control" value="1">
                                            <span class="input-group-text">x +</span>
                                            <input type="number" id="system-a12" class="form-control" value="2">
                                            <span class="input-group-text">y =</span>
                                            <input type="number" id="system-b1" class="form-control" value="5">
                                        </div>
                                        <div class="input-group mb-2">
                                            <input type="number" id="system-a21" class="form-control" value="3">
                                            <span class="input-group-text">x +</span>
                                            <input type="number" id="system-a22" class="form-control" value="4">
                                            <span class="input-group-text">y =</span>
                                            <input type="number" id="system-b2" class="form-control" value="11">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="solveSystem()">حل النظام</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="system-result" class="alert alert-info" style="min-height: 100px;">
                                    النتيجة ستظهر هنا
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6 mb-4">
        <div class="card bg-dark h-100">
            <div class="card-header">
                <h5><i class="fas fa-percent me-2"></i>حسابات إضافية</h5>
            </div>
            <div class="card-body">
                <div class="accordion" id="calculationsAccordion">
                    <!-- محول الوحدات -->
                    <div class="accordion-item bg-dark">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                محول الوحدات
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#calculationsAccordion">
                            <div class="accordion-body">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <select id="unit-type" class="form-select mb-2">
                                            <option value="length">الطول</option>
                                            <option value="weight">الوزن</option>
                                            <option value="area">المساحة</option>
                                            <option value="volume">الحجم</option>
                                            <option value="temperature">درجة الحرارة</option>
                                        </select>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="input-group mb-2">
                                            <input type="number" id="unit-value" class="form-control" value="1">
                                            <select id="unit-from" class="form-select"></select>
                                            <span class="input-group-text">إلى</span>
                                            <select id="unit-to" class="form-select"></select>
                                            <button class="btn btn-primary" onclick="convertUnit()">تحويل</button>
                                        </div>
                                    </div>
                                </div>
                                <div id="unit-result" class="alert alert-info">النتيجة ستظهر هنا</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- حاسبة التفاضل والتكامل -->
                    <div class="accordion-item bg-dark">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                التفاضل والتكامل
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#calculationsAccordion">
                            <div class="accordion-body">
                                <div class="row mb-3">
                                    <div class="col-md-8">
                                        <div class="input-group mb-2">
                                            <span class="input-group-text">f(x) =</span>
                                            <input type="text" id="calculus-function" class="form-control" placeholder="مثال: x^2 + 3*x">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <select id="calculus-operation" class="form-select">
                                            <option value="derivative">المشتقة d/dx</option>
                                            <option value="integral">التكامل ∫dx</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="calculateCalculus()">حساب</button>
                                <div id="calculus-result" class="alert alert-info mt-3">النتيجة ستظهر هنا</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- حاسبة المصفوفات -->
                    <div class="accordion-item bg-dark">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                المصفوفات
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#calculationsAccordion">
                            <div class="accordion-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label>المصفوفة A</label>
                                        <textarea id="matrix-a" class="form-control" rows="3" placeholder="أدخل المصفوفة مثال:&#10;1 2 3&#10;4 5 6&#10;7 8 9"></textarea>
                                    </div>
                                    <div class="col-md-6">
                                        <label>المصفوفة B (اختياري)</label>
                                        <textarea id="matrix-b" class="form-control" rows="3" placeholder="أدخل المصفوفة مثال:&#10;9 8 7&#10;6 5 4&#10;3 2 1"></textarea>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col">
                                        <select id="matrix-operation" class="form-select">
                                            <option value="det">المحدد (det A)</option>
                                            <option value="inverse">العكس (A^-1)</option>
                                            <option value="transpose">المنقول (A^T)</option>
                                            <option value="add">الجمع (A + B)</option>
                                            <option value="multiply">الضرب (A × B)</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <button class="btn btn-primary w-100" onclick="calculateMatrix()">حساب</button>
                                    </div>
                                </div>
                                <div id="matrix-result" class="alert alert-info">النتيجة ستظهر هنا</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card bg-dark h-100">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>اختصارات وتلميحات</h5>
            </div>
            <div class="card-body">
                <h6>اختصارات الحاسبة</h6>
                <ul>
                    <li><strong>sin(), cos(), tan()</strong> - الدوال المثلثية</li>
                    <li><strong>√()</strong> - الجذر التربيعي</li>
                    <li><strong>^</strong> - الأس (مثال: 2^3 = 8)</li>
                    <li><strong>log()</strong> - اللوغاريتم العشري (الأساس 10)</li>
                    <li><strong>ln()</strong> - اللوغاريتم الطبيعي (الأساس e)</li>
                    <li><strong>π</strong> - ثابت باي (3.14159...)</li>
                    <li><strong>e</strong> - ثابت أويلر (2.71828...)</li>
                </ul>
                
                <h6>تلميحات للرسم البياني</h6>
                <ul>
                    <li>استخدم السحب والإفلات للتنقل في الرسم البياني</li>
                    <li>استخدم عجلة الفأرة للتكبير والتصغير</li>
                    <li>يمكنك رسم عدة دوال معًا بالفصل بينها بفاصلة (,)</li>
                    <li>الصيغة: <code>2*x^2+3*x-4, sin(x), x^2-4</code></li>
                </ul>
                
                <h6>معلومات إضافية</h6>
                <ul>
                    <li>تستخدم الآلة الحاسبة JavaScript لإجراء الحسابات بدقة عالية</li>
                    <li>الرسم البياني يستخدم مكتبة math.js وplotly.js</li>
                    <li>جميع العمليات تُجرى على جهازك ولا يتم إرسال أي بيانات للخادم</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="d-flex justify-content-center mt-4 mb-5">
    <a href="{{ url_for('student.dashboard') }}" class="btn btn-secondary me-2">
        <i class="fas fa-home me-1"></i>العودة للوحة التحكم
    </a>
    <a href="{{ url_for('student.math_formulas') }}" class="btn btn-primary">
        <i class="fas fa-book me-1"></i>عرض قوانين الرياضيات
    </a>
</div>
{% endblock %}

{% block scripts %}
<!-- إضافة مكتبة math.js للحسابات الرياضية -->
<script src="https://cdn.jsdelivr.net/npm/mathjs@11.5.0/lib/browser/math.min.js"></script>

<!-- إضافة مكتبة plotly.js للرسم البياني -->
<script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>

<script>
    // ===== الآلة الحاسبة =====
    let displayValue = '';
    const display = document.getElementById('display');
    const result = document.getElementById('result');
    const history = document.getElementById('history');
    
    function addToDisplay(value) {
        displayValue += value;
        display.value = displayValue;
    }
    
    function clearDisplay() {
        displayValue = '';
        display.value = '';
        result.innerHTML = '';
    }
    
    function backspace() {
        displayValue = displayValue.slice(0, -1);
        display.value = displayValue;
    }
    
    function calculate() {
        try {
            // استبدال بعض الرموز والتعبيرات لتتوافق مع math.js
            let expression = displayValue
                .replace(/π/g, 'pi')
                .replace(/√\(/g, 'sqrt(')
                .replace(/\^/g, '**')
                .replace(/asin\(/g, 'asin(')  // المثلثية العكسية
                .replace(/acos\(/g, 'acos(')
                .replace(/atan\(/g, 'atan(')
                .replace(/abs\(/g, 'abs(')    // القيمة المطلقة
                .replace(/(\d+)!/g, 'factorial($1)'); // المضروب
            
            // حساب النتيجة
            const answer = math.evaluate(expression);
            result.innerHTML = `<strong>النتيجة:</strong> ${answer}`;
            
            // إضافة العملية للسجل
            history.innerHTML += `<div>${displayValue} = ${answer}</div>`;
            
            // جعل النتيجة هي القيمة الجديدة
            displayValue = answer.toString();
            display.value = displayValue;
        } catch (error) {
            result.innerHTML = `<span class="text-danger">خطأ: ${error.message}</span>`;
        }
    }
    
    // ===== الرسم البياني =====
    // إعداد الرسم البياني
    const graphDiv = document.getElementById('function-graph');
    let currentPlot = null;
    
    // دالة الرسم البياني
    function plotFunction() {
        try {
            const functionText = document.getElementById('function-input').value;
            const xMin = parseFloat(document.getElementById('x-min').value);
            const xMax = parseFloat(document.getElementById('x-max').value);
            
            // التحقق من صحة المدخلات
            if (!functionText) {
                alert('يرجى إدخال معادلة الدالة');
                return;
            }
            
            if (xMin >= xMax) {
                alert('يجب أن تكون قيمة X الصغرى أقل من قيمة X العظمى');
                return;
            }
            
            // إنشاء مصفوفة القيم السينية
            const xValues = [];
            const step = (xMax - xMin) / 1000;
            for (let x = xMin; x <= xMax; x += step) {
                xValues.push(x);
            }
            
            // تحويل معادلة الدالة لتتوافق مع math.js
            const functionExpr = functionText
                .replace(/\^/g, '**')
                .replace(/sin\(/g, 'Math.sin(')
                .replace(/cos\(/g, 'Math.cos(')
                .replace(/tan\(/g, 'Math.tan(')
                .replace(/asin\(/g, 'Math.asin(')
                .replace(/acos\(/g, 'Math.acos(')
                .replace(/atan\(/g, 'Math.atan(')
                .replace(/sqrt\(/g, 'Math.sqrt(')
                .replace(/abs\(/g, 'Math.abs(')
                .replace(/log\(/g, 'Math.log10(')
                .replace(/ln\(/g, 'Math.log(')
                .replace(/π/g, 'Math.PI')
                .replace(/pi/g, 'Math.PI')
                .replace(/e(?!\w)/g, 'Math.E');
            
            // حساب قيم الدالة
            const yValues = xValues.map(x => {
                try {
                    // استخدام eval لتقييم التعبير (مع حذر)
                    return eval(functionExpr.replace(/x/g, `(${x})`));
                } catch (e) {
                    return null; // إرجاع null للقيم غير المعرفة
                }
            });
            
            // إنشاء البيانات للرسم
            const trace = {
                x: xValues,
                y: yValues,
                type: 'scatter',
                mode: 'lines',
                line: { color: '#1f77b4', width: 2 }
            };
            
            // إعداد الرسم
            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                xaxis: {
                    title: 'x',
                    gridcolor: '#444',
                    zerolinecolor: '#666'
                },
                yaxis: {
                    title: 'y',
                    gridcolor: '#444',
                    zerolinecolor: '#666'
                },
                margin: { t: 10, b: 40, l: 60, r: 10 }
            };
            
            // إنشاء الرسم أو تحديثه
            if (currentPlot) {
                Plotly.react(graphDiv, [trace], layout);
            } else {
                Plotly.newPlot(graphDiv, [trace], layout);
                currentPlot = true;
            }
            
            // عرض معلومات أساسية عن الدالة
            const functionInfo = document.getElementById('function-info');
            functionInfo.innerHTML = `<strong>الدالة:</strong> f(x) = ${functionText}<br>
                                      <strong>المجال:</strong> [${xMin}, ${xMax}]`;
        } catch (error) {
            console.error('Error plotting function:', error);
            alert('حدث خطأ أثناء رسم الدالة. يرجى التأكد من صيغة المعادلة.');
        }
    }
    
    // دوال حل المعادلات
    function solveLinear() {
        try {
            const a = parseFloat(document.getElementById('linear-a').value);
            const b = parseFloat(document.getElementById('linear-b').value);
            
            if (a === 0) {
                if (b === 0) {
                    document.getElementById('linear-result').innerHTML = 'المعادلة لها عدد لا نهائي من الحلول.';
                } else {
                    document.getElementById('linear-result').innerHTML = 'المعادلة ليس لها حل.';
                }
            } else {
                const x = -b / a;
                document.getElementById('linear-result').innerHTML = `<strong>الحل:</strong> x = ${x}`;
            }
        } catch (error) {
            document.getElementById('linear-result').innerHTML = `<span class="text-danger">خطأ: ${error.message}</span>`;
        }
    }
    
    function solveQuadratic() {
        try {
            const a = parseFloat(document.getElementById('quadratic-a').value);
            const b = parseFloat(document.getElementById('quadratic-b').value);
            const c = parseFloat(document.getElementById('quadratic-c').value);
            
            if (a === 0) {
                // المعادلة خطية
                solveLinear(b, c);
                return;
            }
            
            const discriminant = b * b - 4 * a * c;
            let result = '';
            
            if (discriminant > 0) {
                // جذران حقيقيان مختلفان
                const x1 = (-b + Math.sqrt(discriminant)) / (2 * a);
                const x2 = (-b - Math.sqrt(discriminant)) / (2 * a);
                result = `<strong>المميز:</strong> Δ = ${discriminant} > 0<br>
                          <strong>الجذران الحقيقيان:</strong><br>
                          x₁ = ${x1}<br>
                          x₂ = ${x2}`;
            } else if (discriminant === 0) {
                // جذر حقيقي مكرر
                const x = -b / (2 * a);
                result = `<strong>المميز:</strong> Δ = 0<br>
                          <strong>الجذر الحقيقي المكرر:</strong><br>
                          x = ${x}`;
            } else {
                // جذران مركبان
                const realPart = -b / (2 * a);
                const imagPart = Math.sqrt(-discriminant) / (2 * a);
                result = `<strong>المميز:</strong> Δ = ${discriminant} < 0<br>
                          <strong>الجذران المركبان:</strong><br>
                          x₁ = ${realPart} + ${imagPart}i<br>
                          x₂ = ${realPart} - ${imagPart}i`;
            }
            
            document.getElementById('quadratic-result').innerHTML = result;
        } catch (error) {
            document.getElementById('quadratic-result').innerHTML = `<span class="text-danger">خطأ: ${error.message}</span>`;
        }
    }
    
    function solveSystem() {
        try {
            const a11 = parseFloat(document.getElementById('system-a11').value);
            const a12 = parseFloat(document.getElementById('system-a12').value);
            const b1 = parseFloat(document.getElementById('system-b1').value);
            const a21 = parseFloat(document.getElementById('system-a21').value);
            const a22 = parseFloat(document.getElementById('system-a22').value);
            const b2 = parseFloat(document.getElementById('system-b2').value);
            
            // حساب المحدد
            const determinant = a11 * a22 - a12 * a21;
            
            if (determinant === 0) {
                // المحدد صفر، نظام المعادلات إما متناقض أو له لانهائية من الحلول
                // نتحقق من حالات خاصة
                const det1 = b1 * a22 - b2 * a12;
                const det2 = a11 * b2 - a21 * b1;
                
                if (det1 === 0 && det2 === 0) {
                    document.getElementById('system-result').innerHTML = 'النظام له عدد لا نهائي من الحلول.';
                } else {
                    document.getElementById('system-result').innerHTML = 'النظام ليس له حل (متناقض).';
                }
            } else {
                // حساب x و y باستخدام قاعدة كرامر
                const x = (b1 * a22 - b2 * a12) / determinant;
                const y = (a11 * b2 - a21 * b1) / determinant;
                
                document.getElementById('system-result').innerHTML = `<strong>الحل:</strong><br>
                                                                    x = ${x}<br>
                                                                    y = ${y}`;
            }
        } catch (error) {
            document.getElementById('system-result').innerHTML = `<span class="text-danger">خطأ: ${error.message}</span>`;
        }
    }
    
    // دوال إضافية للرسم البياني
    function findZeros() {
        const functionText = document.getElementById('function-input').value;
        if (!functionText) {
            alert('يرجى إدخال معادلة الدالة أولاً');
            return;
        }
        
        const functionInfo = document.getElementById('function-info');
        functionInfo.innerHTML += '<br><strong>الأصفار:</strong> يرجى استخدام الحاسبة لإيجاد الأصفار بدقة.';
    }
    
    function findExtremum() {
        const functionText = document.getElementById('function-input').value;
        if (!functionText) {
            alert('يرجى إدخال معادلة الدالة أولاً');
            return;
        }
        
        const functionInfo = document.getElementById('function-info');
        functionInfo.innerHTML += '<br><strong>القيم القصوى:</strong> يمكن إيجادها من خلال المشتقة الأولى والثانية.';
    }
    
    function findDerivative() {
        const functionText = document.getElementById('function-input').value;
        if (!functionText) {
            alert('يرجى إدخال معادلة الدالة أولاً');
            return;
        }
        
        const functionInfo = document.getElementById('function-info');
        functionInfo.innerHTML += '<br><strong>المشتقة:</strong> استخدم قوانين الاشتقاق المناسبة.';
    }
    
    function findIntegral() {
        const functionText = document.getElementById('function-input').value;
        if (!functionText) {
            alert('يرجى إدخال معادلة الدالة أولاً');
            return;
        }
        
        const functionInfo = document.getElementById('function-info');
        functionInfo.innerHTML += '<br><strong>التكامل:</strong> استخدم قوانين التكامل المناسبة.';
    }
    
    // تهيئة الصفحة عند التحميل
    document.addEventListener('DOMContentLoaded', function() {
        // تهيئة محول الوحدات
        const unitTypes = {
            length: [
                { value: 'mm', label: 'مليمتر (mm)' },
                { value: 'cm', label: 'سنتيمتر (cm)' },
                { value: 'm', label: 'متر (m)' },
                { value: 'km', label: 'كيلومتر (km)' },
                { value: 'in', label: 'إنش (in)' },
                { value: 'ft', label: 'قدم (ft)' },
                { value: 'yd', label: 'ياردة (yd)' },
                { value: 'mi', label: 'ميل (mi)' }
            ],
            weight: [
                { value: 'mg', label: 'مليجرام (mg)' },
                { value: 'g', label: 'جرام (g)' },
                { value: 'kg', label: 'كيلوجرام (kg)' },
                { value: 't', label: 'طن (t)' },
                { value: 'oz', label: 'أونصة (oz)' },
                { value: 'lb', label: 'رطل (lb)' }
            ],
            area: [
                { value: 'mm2', label: 'مليمتر مربع (mm²)' },
                { value: 'cm2', label: 'سنتيمتر مربع (cm²)' },
                { value: 'm2', label: 'متر مربع (m²)' },
                { value: 'ha', label: 'هكتار (ha)' },
                { value: 'km2', label: 'كيلومتر مربع (km²)' },
                { value: 'in2', label: 'إنش مربع (in²)' },
                { value: 'ft2', label: 'قدم مربع (ft²)' },
                { value: 'ac', label: 'فدان (ac)' },
                { value: 'mi2', label: 'ميل مربع (mi²)' }
            ],
            volume: [
                { value: 'ml', label: 'مليلتر (ml)' },
                { value: 'l', label: 'لتر (l)' },
                { value: 'm3', label: 'متر مكعب (m³)' },
                { value: 'floz', label: 'أونصة سائلة (fl oz)' },
                { value: 'gal', label: 'جالون (gal)' },
                { value: 'in3', label: 'إنش مكعب (in³)' },
                { value: 'ft3', label: 'قدم مكعب (ft³)' }
            ],
            temperature: [
                { value: 'c', label: 'سيلسيوس (°C)' },
                { value: 'f', label: 'فهرنهايت (°F)' },
                { value: 'k', label: 'كلفن (K)' }
            ]
        };
        
        function updateUnitOptions() {
            const unitType = document.getElementById('unit-type').value;
            const units = unitTypes[unitType];
            
            const fromSelect = document.getElementById('unit-from');
            const toSelect = document.getElementById('unit-to');
            
            // مسح الاختيارات الحالية
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';
            
            // إضافة الوحدات الجديدة
            units.forEach(unit => {
                fromSelect.add(new Option(unit.label, unit.value));
                toSelect.add(new Option(unit.label, unit.value));
            });
            
            // اختيار الوحدة الثانية افتراضياً
            if (toSelect.options.length > 1) {
                toSelect.selectedIndex = 1;
            }
        }
        
        // تهيئة محول الوحدات
        document.getElementById('unit-type').addEventListener('change', updateUnitOptions);
        updateUnitOptions();
    });
</script>

<!-- Add styles for matrix result display -->
<style>
    .matrix-result-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .matrix-row {
        display: flex;
        justify-content: center;
        margin: 2px 0;
    }
    .matrix-cell {
        display: inline-block;
        width: 50px;
        text-align: center;
        padding: 5px;
        background-color: #f8f9fa;
        color: #000;
        margin: 0 2px;
        border-radius: 3px;
    }
</style>

<script src="{{ url_for('static', filename='js/advanced-calculator.js') }}"></script>
{% endblock %}

{% block styles %}
<style>
    .calculator-container {
        max-width: 100%;
    }
    
    button {
        font-weight: bold;
    }
    
    .formula-container {
        font-family: 'Courier New', monospace;
        font-weight: bold;
    }
    
    /* تنسيق الرسم البياني */
    #function-graph {
        background-color: #222;
        border-radius: 5px;
    }
    
    /* تنسيق المصفوفات */
    #matrix-a, #matrix-b {
        font-family: 'Courier New', monospace;
    }
</style>
{% endblock %}